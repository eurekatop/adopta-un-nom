---
const { appId = "EL_TEU_APP_ID" } = Astro.props;
---

<!-- SDK Facebook -->
<script async defer crossorigin="anonymous"
  src="https://connect.facebook.net/en_US/sdk.js"></script>

<!-- Script per inicialitzar i exposar la funci√≥ -->
<script>
  if (!window.fbInitialized) {
    window.fbAsyncInit = function () {
      FB.init({
        appId: '1391693305369500',
        cookie: true,
        xfbml: true,
        version: 'v19.0'
      });
      window.fbInitialized = true;
      console.log('‚úÖ Facebook SDK initialized');
    };

    // Carrega el SDK nom√©s si no est√† carregat
    if (!document.getElementById('facebook-jssdk')) {
      const js = document.createElement('script');
      js.id = 'facebook-jssdk';
      js.src = 'https://connect.facebook.net/en_US/sdk.js';
      document.head.appendChild(js);
    }
  }

  // Crida de login segura
  window.iniciarSessioAmbFacebook = function () {
    if (!window.fbInitialized) {
      alert('Facebook SDK not ready yet');
      return;
    }

    FB.getLoginStatus(function(response) {
      if (response.status === 'connected') {
        FB.api('/me', { fields: 'name' }, function(user) {
          alert(`Hola ${user.name} (ja est√†s loguejat)!`);
        });
      } else {
        FB.login(function(response) {
          if (response.authResponse) {
            FB.api('/me', { fields: 'name' }, function(user) {
              alert(`Benvingut/da ${user.name}!`);
            });
          } else {
            alert('Login cancel¬∑lat');
          }
        });
      }
    });
  };
</script>

<!-- Bot√≥ de login -->
<button onclick="iniciarSessioAmbFacebook()">üîê Inicia sessi√≥ amb Facebook</button>

<!-- Inline script per injectar appId -->
<script is:inline>
  document.querySelectorAll("script").forEach(script => {
    if (script.innerHTML.includes("{{appId}}")) {
      script.innerHTML = script.innerHTML.replace("{{appId}}", "{{appId}}");
    }
  });
</script>
